"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.mochaHooks = void 0;
const playwright_chromium_1 = require("playwright-chromium");
const playwright_firefox_1 = require("playwright-firefox");
const playwright_webkit_1 = require("playwright-webkit");
const config_1 = require("./config");
const scope_1 = require("./scope");
exports.mochaHooks = {
    beforeAll() {
        return __awaiter(this, void 0, void 0, function* () {
            const config = config_1.loadConfig('./playwright-mocha.json');
            if (config) {
                //@ts-ignore
                scope_1.TestScope.scope = {};
                scope_1.TestScope.scope.config = config;
                scope_1.TestScope.scope.browser = yield ({ chromium: playwright_chromium_1.chromium, webkit: playwright_webkit_1.webkit, firefox: playwright_firefox_1.firefox }[scope_1.TestScope.scope.config.browser] || playwright_chromium_1.chromium).launch(scope_1.TestScope.scope.config.playwrightLaunchOptions);
            }
        });
    },
    afterAll() {
        return __awaiter(this, void 0, void 0, function* () {
            yield scope_1.TestScope.scope.browser.close();
        });
    },
    beforeEach() {
        return __awaiter(this, void 0, void 0, function* () {
            const context = yield scope_1.TestScope.scope.browser.newContext(scope_1.TestScope.scope.config.playwrightContextOptions);
            scope_1.TestScope.scope.context = context;
            scope_1.TestScope.scope.page = yield context.newPage();
        });
    },
    afterEach() {
        return __awaiter(this, void 0, void 0, function* () {
            yield scope_1.TestScope.scope.page.close();
        });
    }
};
